---
const id = Math.random().toString(36).slice(2, 11);
---

<div>
	<button id={"spoiler-button-" + id}>Hide Spoilers</button>
</div>
<style>
	button {
		cursor: pointer;
		background-color: var(--layer);
		color: var(--highlight);
		font-size: 0.7em;
		display: flex;
		align-items: center;
		padding: 0.4rem 0.6rem;
		border-radius: 15px;
		width: fit-content;
		margin-block: 0.5rem;

		&:hover {
			background-color: var(--fade);
		}
	}
</style>
<script type="module" define:vars={{ id }} is:inline>
	const spoilerElements = Array.from(document.querySelectorAll("code"));

	const walker = document.createTreeWalker(
		document.getElementById("prose"),
		NodeFilter.SHOW_TEXT,
		null,
		false,
	);

	let node;
	while ((node = walker.nextNode())) {
		if (
			node.textContent.includes("RISC{") &&
			!spoilerElements.includes(node.parentElement)
		) {
			spoilerElements.push(node.parentElement);
		}
	}

	const spoilerButton = document.getElementById("spoiler-button-" + id);
	let hidden = false;
	spoilerButton.addEventListener("click", () => {
		hidden = !hidden;
		spoilerButton.innerText = hidden ? "Show Spoilers" : "Hide Spoilers";
		for (const elem of spoilerElements) {
			elem.classList.toggle("code-spoiler");
		}
	});
</script>
