---
const id = Math.random().toString(36).slice(2, 11);
---

<template id={"header-link-" + id}>
	<button class="header-link">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
			<path
				fill="none"
				stroke="currentColor"
				stroke-linecap="round"
				stroke-linejoin="round"
				stroke-width="2"
				d="m9 15l6-6m-4-3l.463-.536a5 5 0 0 1 7.071 7.072L18 13m-5 5l-.397.534a5.07 5.07 0 0 1-7.127 0a4.97 4.97 0 0 1 0-7.071L6 11"
			>
			</path>
		</svg>
	</button>
</template>
<script type="module" define:vars={{ id }} is:inline>
	const template = document.getElementById("header-link-" + id);

	const headers = Array.from(
		document
			.getElementById("prose")
			.querySelectorAll("h1:not(.title h1), h2, h3, h4, h5, h6"),
	);

	for (const header of headers) {
		const instance = template.content.cloneNode(true);
		const button = instance.querySelector(".header-link");
		header.appendChild(instance);

		button.addEventListener("click", async () => {
			const url = new URL(location.href);
			url.hash = header.id;
			await navigator.clipboard.writeText(url.href);
		});
	}
</script>
<style>
	.header-link {
		position: absolute;
		left: 0;
		top: 50%;
		transform: translate(-100%, -50%);
		display: flex;
		align-items: center;
		justify-content: center;
		height: 1em;
		aspect-ratio: 1 / 1;
		background: none;
		color: var(--text);
		opacity: 0;
		box-sizing: content-box;
		padding-inline: 0.2em;
		cursor: pointer;
	}
	.header-link:hover {
		opacity: 0.6;
	}
	.header-link:active {
		opacity: 0.8;
	}
</style>
<style is:global>
	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		&:hover {
			.header-link {
				opacity: 0.9;
			}
		}
	}
</style>
